# Политики обслуживания виртуальных машин

*Политики обслуживания* виртуальных машин (Compute Maintenance Policies) дают возможность сообщить о плановом воздействии на ВМ пользователя со стороны инфраструктуры облака с помощью [сервиса метаданных](vm-metadata.md).

Под плановым воздействием понимается наступление одного из следующих событий обслуживания для ВМ:

* `TERMINATE_ON_HOST_MAINTENANCE` — запланирован перезапуск ВМ пользователя.
* `MIGRATE_ON_HOST_MAINTENANCE` — запланирована [динамическая миграция](live-migration.md) ВМ пользователя на другой хост (сервер).

Политику обслуживания ВМ можно определить c помощью:

* Типа политики обслуживания — `maintenance_policy`.
* Времени начала ее исполнения — `maintenance_grace_period`.

Поддерживаются следующие типы политики обслуживания:

* `RESTART` — при наступлении события обслуживания в метаданных появляется строчка `TERMINATE_ON_HOST_MAINTENANCE`. По прошествии `maintenance_grace_period` ВМ будет перемещена на другой хост через процедуры остановки ВМ и ее запуска.
* `MIGRATE` — при наступлении события обслуживания в метаданных ВМ появляется строка `MIGRATE_ON_HOST_MAINTENANCE`. По прошествии `maintenance_grace_period` ВМ будет перемещена на другой хост с помощью процедуры живой миграции.
* `MAINTENANCE_POLICY_UNSPECIFIED` — политика не задана. В сервис метаданных ничего не выставляется, ожидание перед обслуживанием не происходит.

При задании времени начала обслуживания следует помнить, что начало выполнения можно максимально задержать на следующий интервал времени от момента наступления события обслуживания:

* `до 1 минуты` для ВМ без GPU.
* `до 24 часов` для ВМ с GPU.

### Особенности для прерываемых ВМ {#preemptible-vm}

[Прерываемые ВМ](preemptible-vm.md) при наступлении событий обслуживания не мигрируют, а просто останавливаются. При этом никаких событий обслуживания в метаданных ВМ не появляется.

### Особенности для ВМ с GPU {#vm-with-gpu}

Если для ВМ с GPU (непрерываемых) настроена политика `RESTART`, [уведомления на электронную почту](../../resource-manager/concepts/notify.md#technical) о планируемых работах на таких ВМ отключаются. При планируемых работах произойдет автоматический перезапуск ВМ через `maintenance_grace_period` после появления события обслуживания в метаданных.

### Как включить {#apply}

[Включить и настроить](../operations/vm-control/vm-update-policies.md) политики обслуживания ВМ можно с помощью [CLI](../../cli/index.yaml) и [{{ TF }}](../../tutorials/infrastructure-management/terraform-quickstart.md). В консоли управления политики обслуживания сейчас настраивать нельзя.
